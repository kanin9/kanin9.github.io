<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">
  <meta name="google-site-verification" content="7KJy1PzJiembrfrHhOlsbL_CYSr-zHARDD6xkKA5S8I" />

  <title>Frozen Cake Writeup [CakeCTF 2022]</title>

  <link rel="stylesheet" href="/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Frozen Cake Writeup [CakeCTF 2022] | Alikraken’s Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Frozen Cake Writeup [CakeCTF 2022]" />
<meta name="author" content="Alikraken" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Oh your cake is frozen. please warm it up and get the first cake." />
<meta property="og:description" content="Oh your cake is frozen. please warm it up and get the first cake." />
<link rel="canonical" href="http://localhost:8000/frozen-cake" />
<meta property="og:url" content="http://localhost:8000/frozen-cake" />
<meta property="og:site_name" content="Alikraken’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-04T00:00:00+06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Frozen Cake Writeup [CakeCTF 2022]" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alikraken","url":"https://kanin9.github.io/"},"dateModified":"2022-09-04T00:00:00+06:00","datePublished":"2022-09-04T00:00:00+06:00","description":"Oh your cake is frozen. please warm it up and get the first cake.","headline":"Frozen Cake Writeup [CakeCTF 2022]","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:8000/frozen-cake"},"url":"http://localhost:8000/frozen-cake"}</script>
<!-- End Jekyll SEO tag -->

</head>

<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X6HLB9WBLS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X6HLB9WBLS');
</script>


<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1>alikraken@home:~$</h1>
    </a>
    <div class="header-links">
      <a href="/archive"><h2 class="header-link">Archive</h2></a>
<a href="/about"><h2 class="header-link">About</h2></a>


    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>Frozen Cake Writeup [CakeCTF 2022]</h2>
  <time datetime="2022-09-04T00:00:00+06:00" class="by-line">04 Sep 2022</time>
  <br><br> 
  <span style="display: block;">[
  
    
    <a href="/frozen-cake" style="text-decoration:none"><code class="highligher-rouge"><nobr>crypto</nobr></code></a>
  
    
    <a href="/frozen-cake" style="text-decoration:none"><code class="highligher-rouge"><nobr>warmup</nobr></code></a>
  
    
    <a href="/frozen-cake" style="text-decoration:none"><code class="highligher-rouge"><nobr>cakectf</nobr></code></a>
  
  ]</span>
  
  <p><em>Oh your cake is frozen. please warm it up and get the first cake.</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">getPrime</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">FLAG</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">FakeCTF{warmup_a_frozen_cake}</span><span class="sh">"</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">flag</span><span class="p">.</span><span class="nf">encode</span><span class="p">().</span><span class="nf">hex</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="nf">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="nf">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">n =</span><span class="sh">"</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">a =</span><span class="sh">"</span><span class="p">,</span> <span class="nf">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">b =</span><span class="sh">"</span><span class="p">,</span> <span class="nf">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">c =</span><span class="sh">"</span><span class="p">,</span> <span class="nf">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</code></pre></div></div>

<p>This task was built around general intuition of how RSA works, especially the decryption part.</p>

<p>To solve this challenge you need to learn about generalised form of Fermat’s Little Theorem, here it is:</p>

<p><strong>a^(ф(n)) = 1 mod n</strong> <em>(n here is not necessarily prime)</em></p>

<p>And as we remember totient function for n is just <strong>(p-1)(q-1)</strong></p>

<p>We can factor totient as <strong>n - p - q - 1</strong></p>

<p>To substract exponents we should divide one ciphertext by another, but how can we do it in a modulo scenario?
For this purposes exist modular inverses. Dividing <code class="language-plaintext highlighter-rouge">c</code> value by <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>, or more specifically multiplying <code class="language-plaintext highlighter-rouge">c</code> by modular inverses of <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>, we get almost here, now we need to somehow calculate m. Let’s take a side look on what we already figured out.</p>

<p><strong>d = m^(n - p - q)</strong></p>

<p><strong>dm = 1 (mod n)</strong></p>

<p>Last equation seems familiar ain’t so?
Yes, m is just modular inverse for our value d modulo n</p>

<p>So far, so good, we get a solution.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span> <span class="o">=</span> <span class="mi">101205131618457490641888226172378900782027938652382007193297646066245321085334424928920128567827889452079884571045344711457176257019858157287424646000972526730522884040459357134430948940886663606586037466289300864147185085616790054121654786459639161527509024925015109654917697542322418538800304501255357308131</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">38686943509950033726712042913718602015746270494794620817845630744834821038141855935687477445507431250618882887343417719366326751444481151632966047740583539454488232216388308299503129892656814962238386222995387787074530151173515835774172341113153924268653274210010830431617266231895651198976989796620254642528</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">83977895709438322981595417453453058400465353471362634652936475655371158094363869813512319678334779139681172477729044378942906546785697439730712057649619691929500952253818768414839548038664187232924265128952392200845425064991075296143440829148415481807496095010301335416711112897000382336725454278461965303477</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">21459707600930866066419234194792759634183685313775248277484460333960658047171300820279668556014320938220170794027117386852057041210320434076253459389230704653466300429747719579911728990434338588576613885658479123772761552010662234507298817973164062457755456249314287213795660922615911433075228241429771610549</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="nf">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="nf">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>
<span class="n">m</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="nf">fromhex</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]))</span>
</code></pre></div></div>
<p>If you read my explanation all the way through, try solution for yourself. Don’t be a coward. 🤠</p>



</article>

      </section>
    </div>
  </div>

   <footer>
  <a href="https://creativecommons.org/licenses/by-nc/3.0/deed.en_US">
    <span>
        <b>Alikraken</b>
    </span>
    
    <span>© 2023</span>
  </a>
</footer>

  
</body>

</html>
